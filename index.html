<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç∫ La Taverne des Scores V2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #8B4513 100%);
            min-height: 100vh;
            padding: 10px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(90deg, rgba(139, 69, 19, 0.1) 0px, transparent 1px, transparent 50px, rgba(139, 69, 19, 0.1) 51px),
                repeating-linear-gradient(0deg, rgba(139, 69, 19, 0.1) 0px, transparent 1px, transparent 50px, rgba(139, 69, 19, 0.1) 51px);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(to bottom, #2C1810 0%, #1a0f0a 100%);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8), inset 0 1px 0 rgba(255,255,255,0.1);
            overflow: hidden;
            position: relative;
            z-index: 1;
            border: 3px solid #8B4513;
        }

        .header {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
            color: #FFD700;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            border-bottom: 5px solid #654321;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .header::before {
            content: 'üç∫';
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3em;
            opacity: 0.3;
        }

        .header::after {
            content: 'üç∫';
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3em;
            opacity: 0.3;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            font-family: 'Georgia', serif;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 1.1em;
            color: #FFA500;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
        }

        .content {
            padding: 30px;
            color: #FFE4B5;
        }

        .category {
            margin-bottom: 40px;
        }

        .category h3 {
            color: #FFD700;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #8B4513;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-family: 'Georgia', serif;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .game-card {
            background: linear-gradient(135deg, #654321 0%, #8B4513 100%);
            color: #FFD700;
            padding: 30px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid #A0522D;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
        }

        .game-card:hover::before {
            left: 100%;
        }

        .game-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
        }

        .game-card.classic {
            background: linear-gradient(135deg, #8B0000 0%, #CD5C5C 100%);
        }

        .game-card.modern {
            background: linear-gradient(135deg, #4B0082 0%, #9370DB 100%);
        }

        .game-card.outdoor {
            background: linear-gradient(135deg, #228B22 0%, #90EE90 100%);
        }

        .game-card.other {
            background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
        }

        .game-card h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .game-card p {
            font-size: 0.9em;
            opacity: 0.9;
            color: #FFE4B5;
            position: relative;
            z-index: 1;
        }

        .btn {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: #FFD700;
            border: 2px solid #FFD700;
            padding: 14px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
            background: linear-gradient(135deg, #A0522D 0%, #CD853F 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4B0082 0%, #6A5ACD 100%);
            border-color: #DDA0DD;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #6A5ACD 0%, #9370DB 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
            border-color: #FF6347;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #DC143C 0%, #FF6347 100%);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .player-list {
            margin-top: 20px;
        }

        .player-item {
            background: linear-gradient(135deg, #654321 0%, #8B4513 100%);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #A0522D;
            color: #FFD700;
        }

        .player-checkbox {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, #654321 0%, #8B4513 100%);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #A0522D;
            color: #FFD700;
        }

        .player-checkbox:hover {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            border-color: #FFD700;
            transform: translateX(5px);
        }

        .player-checkbox input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #FFD700;
        }

        .team-section {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #2C1810 0%, #1a0f0a 100%);
            border-radius: 10px;
            border: 3px solid #8B4513;
        }

        .team-section h3 {
            margin-bottom: 15px;
            color: #FFD700;
            font-size: 1.4em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #FFD700;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #8B4513;
            border-radius: 8px;
            font-size: 1em;
            background: #2C1810;
            color: #FFD700;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .score-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
            background: #1a0f0a;
            border-radius: 10px;
            border: 3px solid #8B4513;
        }

        .score-table thead, .score-table tbody {
            display: table;
            width: 100%;
        }

        .score-table th, .score-table td {
            padding: 15px 10px;
            text-align: center;
            border-bottom: 2px solid #654321;
        }

        .score-table th {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: #FFD700;
            font-weight: bold;
            position: sticky;
            top: 0;
            font-size: 1.1em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .score-table td {
            color: #FFE4B5;
        }

        .score-table tr:hover {
            background: rgba(139, 69, 19, 0.3);
        }

        .total-row {
            font-weight: bold;
            background: linear-gradient(135deg, #654321 0%, #8B4513 100%) !important;
            font-size: 1.3em;
            color: #FFD700 !important;
            border-top: 3px solid #FFD700;
        }

        .round-details {
            background: linear-gradient(135deg, #2C1810 0%, #654321 100%);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9em;
            margin-top: 5px;
            border: 2px solid #8B4513;
            color: #FFD700;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: linear-gradient(to bottom, #2C1810 0%, #1a0f0a 100%);
            max-width: 600px;
            margin: 50px auto;
            padding: 35px;
            border-radius: 15px;
            max-height: 85vh;
            overflow-y: auto;
            border: 4px solid #8B4513;
            box-shadow: 0 10px 50px rgba(255, 215, 0, 0.3);
            color: #FFE4B5;
        }

        .modal-content h2 {
            color: #FFD700;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-size: 2em;
            text-align: center;
        }

        .modal-content h3 {
            color: #FFA500;
            margin: 20px 0 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .back-btn {
            display: inline-block;
            margin-bottom: 20px;
            color: #FFD700;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .back-btn:hover {
            color: #FFA500;
            transform: translateX(-5px);
        }

        .hidden {
            display: none;
        }

        .settings-icon {
            position: absolute;
            top: 30px;
            right: 30px;
            font-size: 2em;
            cursor: pointer;
            transition: transform 0.3s;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
        }

        .settings-icon:hover {
            transform: rotate(90deg) scale(1.2);
        }

        .info-box {
            background: linear-gradient(135deg, #1e3a5f 0%, #2a5298 100%);
            border-left: 5px solid #4169E1;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            color: #E6F3FF;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        .warning-box {
            background: linear-gradient(135deg, #8B4513 0%, #CD853F 100%);
            border-left: 5px solid #FFD700;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            color: #FFFACD;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        .success-box {
            background: linear-gradient(135deg, #2F4F2F 0%, #3CB371 100%);
            border-left: 5px solid #90EE90;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            color: #F0FFF0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .game-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }

            .game-card {
                padding: 20px 12px;
            }

            .game-card h3 {
                font-size: 1.2em;
            }

            .game-card p {
                font-size: 0.85em;
            }
            
            .container {
                margin: 0;
                border-radius: 0;
                border: none;
            }

            .header {
                padding: 25px 15px;
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.6em;
                letter-spacing: 1px;
            }

            .header p {
                font-size: 0.95em;
            }

            .header::before,
            .header::after {
                font-size: 1.5em;
                left: 10px;
            }

            .header::after {
                right: 10px;
                left: auto;
            }

            .settings-icon {
                top: 20px;
                right: 15px;
                font-size: 1.5em;
            }

            .content {
                padding: 15px;
            }

            .category h3 {
                font-size: 1.4em;
                margin-bottom: 15px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 1em;
                margin: 3px;
            }

            .modal-content {
                margin: 20px 10px;
                padding: 20px;
                max-height: 90vh;
            }

            .modal-content h2 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }

            .input-group label {
                font-size: 1em;
            }

            .input-group input,
            .input-group select {
                padding: 10px;
                font-size: 0.95em;
            }
            
            .score-table {
                font-size: 0.85em;
            }

            .score-table th, 
            .score-table td {
                padding: 8px 4px;
                font-size: 0.85em;
            }

            .score-table th {
                font-size: 0.9em;
            }

            .total-row {
                font-size: 1.1em;
            }

            .round-details {
                font-size: 0.8em;
                padding: 6px;
            }

            .player-checkbox {
                padding: 10px;
                margin: 6px 0;
            }

            .player-checkbox input[type="checkbox"] {
                width: 18px;
                height: 18px;
                margin-right: 8px;
            }

            .team-section {
                padding: 15px;
                margin: 15px 0;
            }

            .team-section h3 {
                font-size: 1.2em;
            }

            .player-item {
                padding: 12px;
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }

            .back-btn {
                font-size: 1em;
                margin-bottom: 15px;
            }

            .info-box,
            .warning-box,
            .success-box {
                padding: 12px;
                margin: 12px 0;
                font-size: 0.9em;
            }

            /* Am√©lioration du scroll horizontal sur les tableaux */
            .score-table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* Message d'aide pour le scroll */
            .score-table::after {
                content: '‚Üê Glissez pour voir plus ‚Üí';
                display: block;
                text-align: center;
                padding: 10px;
                font-size: 0.8em;
                color: #FFA500;
                font-style: italic;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.4em;
            }

            .game-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .game-card {
                padding: 18px 10px;
            }

            .game-card h3 {
                font-size: 1.1em;
            }

            .btn {
                padding: 10px 16px;
                font-size: 0.95em;
            }

            .category h3 {
                font-size: 1.2em;
            }

            .score-table th,
            .score-table td {
                padding: 6px 3px;
                font-size: 0.8em;
            }
        }

        /* Scrollbar personnalis√©e */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #2C1810;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            border-radius: 10px;
            border: 2px solid #2C1810;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #A0522D 0%, #CD853F 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="settings-icon" onclick="app.showSettings()">‚öôÔ∏è</div>
            <h1>üç∫ La Taverne des Scores</h1>
            <p>Comptez vos points et profitez de vos parties !</p>
        </div>

        <div class="content">
            <!-- Accueil -->
            <div id="home-screen">
                <div class="category">
                    <h3>üé¥ Jeux Classiques</h3>
                    <div class="game-grid">
                        <div class="game-card classic" onclick="app.selectGame('tarot')">
                            <h3>üÉè Tarot</h3>
                            <p>3 √† 5 joueurs</p>
                        </div>
                        <div class="game-card classic" onclick="app.selectGame('belote')">
                            <h3>üÇ° Belote</h3>
                            <p>4 joueurs (2v2)</p>
                        </div>
                        <div class="game-card classic" onclick="app.selectGame('coinche')">
                            <h3>üéØ Coinche</h3>
                            <p>4 joueurs (2v2)</p>
                        </div>
                        <div class="game-card classic" onclick="app.selectGame('rami')">
                            <h3>üé¥ Rami</h3>
                            <p>2 √† 6 joueurs</p>
                        </div>
                        <div class="game-card classic" onclick="app.selectGame('simonette')">
                            <h3>üé≤ Simonette</h3>
                            <p>2 √† 6 joueurs</p>
                        </div>
                        <div class="game-card classic" onclick="app.selectGame('tarotafricain')">
                            <h3>üåç Tarot Africain</h3>
                            <p>3 √† 5 joueurs</p>
                        </div>
                    </div>
                </div>

                <div class="category">
                    <h3>üéÆ Jeux Modernes</h3>
                    <div class="game-grid">
                        <div class="game-card modern" onclick="app.selectGame('skyjo')">
                            <h3>‚òÅÔ∏è Skyjo</h3>
                            <p>2 √† 8 joueurs</p>
                        </div>
                        <div class="game-card modern" onclick="app.selectGame('papayoo')">
                            <h3>ü¶ú Papayoo</h3>
                            <p>3 √† 8 joueurs</p>
                        </div>
                        <div class="game-card modern" onclick="app.selectGame('uno')">
                            <h3>üåà UNO</h3>
                            <p>2 √† 10 joueurs</p>
                        </div>
                        <div class="game-card modern" onclick="app.selectGame('rummikub')">
                            <h3>üé≤ Rummikub</h3>
                            <p>2 √† 4 joueurs</p>
                        </div>
                        <div class="game-card modern" onclick="app.selectGame('yams')">
                            <h3>üé≤ Yams</h3>
                            <p>2 √† 6 joueurs</p>
                        </div>
                    </div>
                </div>

                <div class="category">
                    <h3>üå≥ Jeux d'Ext√©rieur</h3>
                    <div class="game-grid">
                        <div class="game-card outdoor" onclick="app.selectGame('paletbreton')">
                            <h3>ü•è Palet Breton</h3>
                            <p>2 joueurs/√©quipes</p>
                        </div>
                        <div class="game-card outdoor" onclick="app.selectGame('molkky')">
                            <h3>üé≥ M√∂lkky</h3>
                            <p>2 √† 6 joueurs</p>
                        </div>
                        <div class="game-card outdoor" onclick="app.selectGame('petanque')">
                            <h3>‚ö™ P√©tanque</h3>
                            <p>2 √† 6 joueurs</p>
                        </div>
                    </div>
                </div>

                <div class="category">
                    <h3>‚öôÔ∏è Autres</h3>
                    <div class="game-grid">
                        <div class="game-card other" onclick="app.selectGame('8americain')">
                            <h3>üé¥ 8 Am√©ricain</h3>
                            <p>2 √† 8 joueurs</p>
                        </div>
                        <div class="game-card other" onclick="app.selectGame('poker')">
                            <h3>üÉè Poker</h3>
                            <p>2 √† 10 joueurs</p>
                        </div>
                        <div class="game-card other" onclick="app.selectGame('simple')">
                            <h3>üìä Compteur Libre</h3>
                            <p>Personnalis√©</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- S√©lection des joueurs -->
            <div id="player-selection-screen" class="hidden">
                <span class="back-btn" onclick="app.goHome()">‚Üê Retour √† la taverne</span>
                <h2 style="color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">Qui participe √† cette partie ?</h2>
                <div id="player-selection-content"></div>
                <button class="btn" onclick="app.startGameWithPlayers()">üçª Lancer la partie !</button>
            </div>

            <!-- √âcran de jeu -->
            <div id="game-screen" class="hidden">
                <span class="back-btn" onclick="app.goHome()">‚Üê Retour √† la taverne</span>
                <h2 id="game-title" style="color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);"></h2>
                <button class="btn" onclick="app.showNewRoundModal()">‚ûï Nouvelle Manche</button>
                <button class="btn btn-secondary" onclick="app.resetGame()">üîÑ R√©initialiser</button>
                
                <div id="score-display"></div>
            </div>
        </div>
    </div>

    <!-- Modal Nouvelle Manche -->
    <div id="new-round-modal" class="modal">
        <div class="modal-content">
            <h2>üìù Nouvelle Manche</h2>
            <div id="round-form"></div>
            <button class="btn" onclick="app.submitRound()">‚úÖ Valider</button>
            <button class="btn btn-danger" onclick="app.closeModal('new-round-modal')">‚ùå Annuler</button>
        </div>
    </div>

    <!-- Modal Param√®tres -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <h2>‚öôÔ∏è Param√®tres</h2>
            
            <h3>üë• Gestion des Joueurs</h3>
            <div class="input-group">
                <input type="text" id="new-player-name" placeholder="Nom du nouveau joueur...">
                <button class="btn" onclick="app.addPlayer()">‚ûï Ajouter</button>
            </div>
            
            <div class="player-list" id="player-list"></div>
            
            <button class="btn btn-secondary" onclick="app.closeModal('settings-modal')">Fermer</button>
        </div>
    </div>

    <script>
        // Configuration des jeux
        const GAMES_CONFIG = {
            tarot: {
                name: 'Tarot',
                icon: 'üÉè',
                minPlayers: 3,
                maxPlayers: 5,
                hasTeams: false,
                description: 'Jeu de tarot fran√ßais traditionnel',
                
                getRoundForm: (players) => `
                    <div class="input-group">
                        <label>üé© Donneur</label>
                        <select id="dealer">
                            ${players.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üëë Preneur</label>
                        <select id="taker">
                            ${players.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üìú Contrat</label>
                        <select id="contract">
                            <option value="petite">Petite</option>
                            <option value="garde">Garde</option>
                            <option value="garde-sans">Garde Sans</option>
                            <option value="garde-contre">Garde Contre</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üéØ Points r√©alis√©s (sur 91)</label>
                        <input type="number" id="points" value="41" min="0" max="91">
                    </div>
                    <div class="input-group">
                        <label>üíé Nombre de bouts</label>
                        <input type="number" id="bouts" value="1" min="0" max="3">
                    </div>
                    <div class="input-group">
                        <label>üé¥ Petit au bout</label>
                        <select id="petit-bout">
                            <option value="none">Non</option>
                            <option value="attaque">Attaque (preneur)</option>
                            <option value="defense">D√©fense</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>ü§ö Poign√©e</label>
                        <select id="poignee">
                            <option value="none">Aucune</option>
                            <option value="simple-attaque">Simple (Attaque) +20pts</option>
                            <option value="simple-defense">Simple (D√©fense) -20pts</option>
                            <option value="double-attaque">Double (Attaque) +30pts</option>
                            <option value="double-defense">Double (D√©fense) -30pts</option>
                            <option value="triple-attaque">Triple (Attaque) +40pts</option>
                            <option value="triple-defense">Triple (D√©fense) -40pts</option>
                        </select>
                    </div>
                `,
                
                calculateRound: (formData, players, scores) => {
                    const taker = formData.taker;
                    const contract = formData.contract;
                    const points = parseInt(formData.points);
                    const bouts = parseInt(formData.bouts);
                    const petitBout = formData['petit-bout'];
                    const poignee = formData.poignee;
                    
                    const required = [56, 51, 41, 36][bouts];
                    const diff = points - required;
                    
                    const multipliers = {
                        'petite': 1,
                        'garde': 2,
                        'garde-sans': 4,
                        'garde-contre': 6
                    };
                    
                    let baseScore = (25 + Math.abs(diff)) * multipliers[contract];
                    
                    if (petitBout !== 'none') {
                        baseScore += (petitBout === 'attaque' ? 10 : -10) * multipliers[contract];
                    }
                    
                    const poigneeBonus = {
                        'simple-attaque': 20,
                        'simple-defense': -20,
                        'double-attaque': 30,
                        'double-defense': -30,
                        'triple-attaque': 40,
                        'triple-defense': -40
                    };
                    if (poignee !== 'none') {
                        baseScore += poigneeBonus[poignee];
                    }
                    
                    const numDefenders = players.length - 1;
                    const won = diff >= 0;
                    
                    if (won) {
                        scores[taker] += baseScore * numDefenders;
                        players.forEach(p => {
                            if (p !== taker) scores[p] -= baseScore;
                        });
                    } else {
                        scores[taker] -= baseScore * numDefenders;
                        players.forEach(p => {
                            if (p !== taker) scores[p] += baseScore;
                        });
                    }
                    
                    return {
                        type: 'tarot',
                        taker,
                        contract,
                        points,
                        bouts,
                        required,
                        won,
                        baseScore,
                        petitBout,
                        poignee,
                        details: `${taker} - ${contract.toUpperCase()} - ${points}pts/${required} (${bouts} bouts) - ${won ? '‚úÖ Gagn√©' : '‚ùå Perdu'}${petitBout !== 'none' ? ' + Petit au bout' : ''}${poignee !== 'none' ? ' + Poign√©e' : ''}`
                    };
                }
            },
            
            belote: {
                name: 'Belote',
                icon: 'üÇ°',
                minPlayers: 4,
                maxPlayers: 4,
                hasTeams: true,
                description: 'Belote classique en √©quipe',
                
                getRoundForm: (players, teams) => `
                    <div class="input-group">
                        <label>üé¥ √âquipe 1 (${teams[0].join(' & ')})</label>
                        <input type="number" id="team1-score" value="0" min="0">
                    </div>
                    <div class="input-group">
                        <label>üé¥ √âquipe 2 (${teams[1].join(' & ')})</label>
                        <input type="number" id="team2-score" value="0" min="0">
                    </div>
                    <div class="info-box">
                        <strong>üí° Rappel :</strong> Total de 162 points par donne (+ annonces √©ventuelles)
                    </div>
                `,
                
                calculateRound: (formData, players, scores, teams) => {
                    const team1Score = parseInt(formData['team1-score']);
                    const team2Score = parseInt(formData['team2-score']);
                    
                    teams[0].forEach(p => scores[p] += team1Score);
                    teams[1].forEach(p => scores[p] += team2Score);
                    
                    return {
                        type: 'belote',
                        team1: team1Score,
                        team2: team2Score,
                        details: `${teams[0].join('/')} : ${team1Score}pts - ${teams[1].join('/')} : ${team2Score}pts`
                    };
                }
            },
            
            coinche: {
                name: 'Coinche',
                icon: 'üéØ',
                minPlayers: 4,
                maxPlayers: 4,
                hasTeams: true,
                description: 'Belote coinch√©e',
                
                getRoundForm: (players, teams) => `
                    <div class="input-group">
                        <label>üë• √âquipe preneur</label>
                        <select id="taking-team">
                            <option value="0">√âquipe 1 (${teams[0].join(' & ')})</option>
                            <option value="1">√âquipe 2 (${teams[1].join(' & ')})</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üì¢ Contrat annonc√©</label>
                        <input type="number" id="contract" value="80" min="80" max="160" step="10">
                    </div>
                    <div class="input-group">
                        <label>üéØ Points r√©alis√©s</label>
                        <input type="number" id="points" value="0" min="0">
                    </div>
                    <div class="input-group">
                        <label>üí• Coinche ?</label>
                        <select id="coinche">
                            <option value="none">Non</option>
                            <option value="coinche">Coinche (x2)</option>
                            <option value="surcoinche">Surcoinche (x4)</option>
                        </select>
                    </div>
                `,
                
                calculateRound: (formData, players, scores, teams) => {
                    const takingTeam = parseInt(formData['taking-team']);
                    const contract = parseInt(formData.contract);
                    const points = parseInt(formData.points);
                    const coinche = formData.coinche;
                    
                    const multiplier = coinche === 'surcoinche' ? 4 : coinche === 'coinche' ? 2 : 1;
                    const won = points >= contract;
                    
                    let teamScore;
                    if (won) {
                        teamScore = (contract + points) * multiplier;
                    } else {
                        teamScore = -contract * multiplier;
                    }
                    
                    const defendingTeam = takingTeam === 0 ? 1 : 0;
                    const defendingScore = won ? 0 : 160 * multiplier;
                    
                    teams[takingTeam].forEach(p => scores[p] += teamScore);
                    teams[defendingTeam].forEach(p => scores[p] += defendingScore);
                    
                    return {
                        type: 'coinche',
                        takingTeam,
                        contract,
                        points,
                        won,
                        coinche,
                        details: `${teams[takingTeam].join('/')} annonce ${contract} - ${won ? '‚úÖ Gagn√©' : '‚ùå Perdu'} avec ${points}pts${coinche !== 'none' ? ' (' + coinche + ')' : ''}`
                    };
                }
            },
            
            rami: {
                name: 'Rami',
                icon: 'üé¥',
                minPlayers: 2,
                maxPlayers: 6,
                hasTeams: false,
                description: 'Rami classique',
                
                getRoundForm: (players) => `
                    <div class="input-group">
                        <label>üèÜ Gagnant de la manche</label>
                        <select id="winner">
                            ${players.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üÉè Points restants pour ${p}</label>
                            <input type="number" id="score-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                    <div class="info-box">
                        <strong>üí° R√®gle :</strong> Les points restants en main comptent n√©gativement pour tous sauf le gagnant
                    </div>
                `,
                
                calculateRound: (formData, players, scores) => {
                    const winner = formData.winner;
                    let totalPenalty = 0;
                    
                    players.forEach(p => {
                        const points = parseInt(formData[`score-${p}`]) || 0;
                        if (p !== winner) {
                            scores[p] -= points;
                            totalPenalty += points;
                        }
                    });
                    
                    scores[winner] += totalPenalty;
                    
                    return {
                        type: 'rami',
                        winner,
                        details: `üèÜ ${winner} gagne la manche (+${totalPenalty}pts)`
                    };
                }
            },
            
            simonette: {
                name: 'Simonette',
                icon: 'üé≤',
                minPlayers: 2,
                maxPlayers: 6,
                hasTeams: false,
                description: 'Jeu de d√©s et strat√©gie',
                
                getRoundForm: (players) => `
                    <div class="input-group">
                        <label>üèÜ Gagnant de la manche</label>
                        <select id="winner">
                            ${players.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üé≤ Score de ${p}</label>
                            <input type="number" id="score-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                `,
                
                calculateRound: (formData, players, scores) => {
                    const winner = formData.winner;
                    
                    players.forEach(p => {
                        const points = parseInt(formData[`score-${p}`]) || 0;
                        scores[p] += points;
                    });
                    
                    return {
                        type: 'simonette',
                        winner,
                        details: `üèÜ ${winner} gagne la manche`
                    };
                }
            },
            
            tarotafricain: {
                name: 'Tarot Africain',
                icon: 'üåç',
                minPlayers: 3,
                maxPlayers: 5,
                hasTeams: false,
                description: 'Variante africaine du tarot',
                
                getRoundForm: (players) => `
                    <div class="input-group">
                        <label>üëë Preneur</label>
                        <select id="taker">
                            ${players.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üéØ Points r√©alis√©s</label>
                        <input type="number" id="points" value="0" min="0">
                    </div>
                    <div class="input-group">
                        <label>‚úÖ Contrat r√©ussi ?</label>
                        <select id="won">
                            <option value="true">Oui</option>
                            <option value="false">Non</option>
                        </select>
                    </div>
                `,
                
                calculateRound: (formData, players, scores) => {
                    const taker = formData.taker;
                    const points = parseInt(formData.points) || 0;
                    const won = formData.won === 'true';
                    
                    if (won) {
                        scores[taker] += points;
                        players.forEach(p => {
                            if (p !== taker) scores[p] -= Math.floor(points / (players.length - 1));
                        });
                    } else {
                        scores[taker] -= points;
                        players.forEach(p => {
                            if (p !== taker) scores[p] += Math.floor(points / (players.length - 1));
                        });
                    }
                    
                    return {
                        type: 'tarotafricain',
                        taker,
                        points,
                        won,
                        details: `${taker} - ${points}pts - ${won ? '‚úÖ R√©ussi' : '‚ùå √âchou√©'}`
                    };
                }
            },
            
            skyjo: {
                name: 'Skyjo',
                icon: '‚òÅÔ∏è',
                minPlayers: 2,
                maxPlayers: 8,
                hasTeams: false,
                description: 'Jeu de cartes moderne',
                
                getRoundForm: (players) => `
                    <div class="info-box">
                        <strong>üí° Rappel :</strong> Plus le score est bas, mieux c'est ! Le but est d'avoir le moins de points.
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>‚òÅÔ∏è Score de ${p}</label>
                            <input type="number" id="score-${p}" value="0">
                        </div>
                    `).join('')}
                `,
                
                calculateRound: (formData, players, scores) => {
                    players.forEach(p => {
                        const points = parseInt(formData[`score-${p}`]) || 0;
                        scores[p] += points;
                    });
                    
                    return {
                        type: 'skyjo',
                        details: 'Manche termin√©e - Attention : score le plus BAS gagne !'
                    };
                }
            },
            
            papayoo: {
                name: 'Papayoo',
                icon: 'ü¶ú',
                minPlayers: 3,
                maxPlayers: 8,
                hasTeams: false,
                description: '√âvitez le Papayoo !',
                
                getRoundForm: (players) => `
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Attention :</strong> Le Papayoo vaut 40 points ! √âvitez-le !
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>ü¶ú Points p√©nalit√© de ${p}</label>
                            <input type="number" id="score-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                `,
                
                calculateRound: (formData, players, scores) => {
                    players.forEach(p => {
                        const points = parseInt(formData[`score-${p}`]) || 0;
                        scores[p] += points;
                    });
                    
                    return {
                        type: 'papayoo',
                        details: 'Manche termin√©e - Points p√©nalit√© ajout√©s'
                    };
                }
            },
            
            uno: {
                name: 'UNO',
                icon: 'üåà',
                minPlayers: 2,
                maxPlayers: 10,
                hasTeams: false,
                description: 'Le c√©l√®bre jeu de cartes',
                
                getRoundForm: (players) => `
                    <div class="input-group">
                        <label>üèÜ Gagnant de la manche</label>
                        <select id="winner">
                            ${players.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üåà Valeur des cartes de ${p}</label>
                            <input type="number" id="cards-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                    <div class="info-box">
                        <strong>üí° Valeurs :</strong> 0-9 = valeur faciale, +2/Inverse/Stop = 20pts, Joker/+4 = 50pts
                    </div>
                `,
                
                calculateRound: (formData, players, scores) => {
                    const winner = formData.winner;
                    let totalPoints = 0;
                    
                    players.forEach(p => {
                        const cards = parseInt(formData[`cards-${p}`]) || 0;
                        if (p !== winner) {
                            totalPoints += cards;
                        }
                    });
                    
                    scores[winner] += totalPoints;
                    
                    return {
                        type: 'uno',
                        winner,
                        details: `üèÜ ${winner} gagne (+${totalPoints}pts)`
                    };
                }
            },
            
            rummikub: {
                name: 'Rummikub',
                icon: 'üé≤',
                minPlayers: 2,
                maxPlayers: 4,
                hasTeams: false,
                description: 'Rummikub',
                
                getRoundForm: (players) => `
                    <div class="input-group">
                        <label>üèÜ Gagnant de la manche</label>
                        <select id="winner">
                            ${players.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üé≤ Points restants de ${p}</label>
                            <input type="number" id="score-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                `,
                
                calculateRound: (formData, players, scores) => {
                    const winner = formData.winner;
                    let totalPenalty = 0;
                    
                    players.forEach(p => {
                        const points = parseInt(formData[`score-${p}`]) || 0;
                        if (p !== winner) {
                            scores[p] -= points;
                            totalPenalty += points;
                        }
                    });
                    
                    scores[winner] += totalPenalty;
                    
                    return {
                        type: 'rummikub',
                        winner,
                        details: `üèÜ ${winner} gagne (+${totalPenalty}pts)`
                    };
                }
            },
            
            yams: {
                name: 'Yams',
                icon: 'üé≤',
                minPlayers: 2,
                maxPlayers: 6,
                hasTeams: false,
                description: 'Yams / Yahtzee',
                
                getRoundForm: (players) => `
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üé≤ Score total de ${p}</label>
                            <input type="number" id="score-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                    <div class="info-box">
                        <strong>üí° Info :</strong> Entrez le score final de chaque joueur pour cette partie
                    </div>
                `,
                
                calculateRound: (formData, players, scores) => {
                    players.forEach(p => {
                        scores[p] = parseInt(formData[`score-${p}`]) || 0;
                    });
                    
                    return {
                        type: 'yams',
                        details: 'üé≤ Partie termin√©e'
                    };
                }
            },
            
            paletbreton: {
                name: 'Palet Breton',
                icon: 'ü•è',
                minPlayers: 2,
                maxPlayers: 4,
                hasTeams: false,
                description: 'Jeu traditionnel breton',
                
                getRoundForm: (players) => `
                    <div class="info-box">
                        <strong>üí° R√®gle :</strong> Premier √† 12 points gagne ! Les palets dans les zones rapportent 1, 2, 3 ou 4 points.
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>ü•è Points de ${p}</label>
                            <input type="number" id="score-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                `,
                
                calculateRound: (formData, players, scores) => {
                    players.forEach(p => {
                        const points = parseInt(formData[`score-${p}`]) || 0;
                        scores[p] += points;
                    });
                    
                    return {
                        type: 'paletbreton',
                        details: 'ü•è Manche termin√©e'
                    };
                }
            },
            
            molkky: {
                name: 'M√∂lkky',
                icon: 'üé≥',
                minPlayers: 2,
                maxPlayers: 6,
                hasTeams: false,
                description: 'Jeu finlandais',
                
                getRoundForm: (players) => `
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Attention :</strong> Premier √† atteindre EXACTEMENT 50 points gagne ! Si vous d√©passez, vous retombez √† 25 points.
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üé≥ Points de ${p}</label>
                            <input type="number" id="score-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                `,
                
                calculateRound: (formData, players, scores) => {
                    players.forEach(p => {
                        const points = parseInt(formData[`score-${p}`]) || 0;
                        scores[p] += points;
                        
                        // R√®gle sp√©ciale M√∂lkky
                        if (scores[p] > 50) {
                            scores[p] = 25;
                        }
                    });
                    
                    return {
                        type: 'molkky',
                        details: 'üé≥ Manche termin√©e'
                    };
                }
            },
            
            petanque: {
                name: 'P√©tanque',
                icon: '‚ö™',
                minPlayers: 2,
                maxPlayers: 6,
                hasTeams: false,
                description: 'Jeu de boules proven√ßal',
                
                getRoundForm: (players) => `
                    <div class="info-box">
                        <strong>üí° R√®gle :</strong> Premier √† 13 points gagne la partie !
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>‚ö™ Points de ${p}</label>
                            <input type="number" id="score-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                `,
                
                calculateRound: (formData, players, scores) => {
                    players.forEach(p => {
                        const points = parseInt(formData[`score-${p}`]) || 0;
                        scores[p] += points;
                    });
                    
                    return {
                        type: 'petanque',
                        details: '‚ö™ M√®ne termin√©e'
                    };
                }
            },
            
            '8americain': {
                name: '8 Am√©ricain',
                icon: 'üé¥',
                minPlayers: 2,
                maxPlayers: 8,
                hasTeams: false,
                description: '8 Am√©ricain',
                
                getRoundForm: (players) => `
                    <div class="input-group">
                        <label>üèÜ Gagnant de la manche</label>
                        <select id="winner">
                            ${players.map(p => `<option value="${p}">${p}</option>`).join('')}
                        </select>
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üé¥ Cartes restantes de ${p}</label>
                            <input type="number" id="cards-${p}" value="0" min="0">
                        </div>
                    `).join('')}
                    <div class="info-box">
                        <strong>üí° Info :</strong> Les cartes restantes comptent comme points n√©gatifs
                    </div>
                `,
                
                calculateRound: (formData, players, scores) => {
                    const winner = formData.winner;
                    let totalCards = 0;
                    
                    players.forEach(p => {
                        const cards = parseInt(formData[`cards-${p}`]) || 0;
                        if (p !== winner) {
                            scores[p] -= cards;
                            totalCards += cards;
                        }
                    });
                    
                    scores[winner] += totalCards;
                    
                    return {
                        type: '8americain',
                        winner,
                        details: `üèÜ ${winner} gagne la manche (+${totalCards}pts)`
                    };
                }
            },
            
            poker: {
                name: 'Poker',
                icon: 'üÉè',
                minPlayers: 2,
                maxPlayers: 10,
                hasTeams: false,
                description: 'Poker - Comptage des gains/pertes',
                
                getRoundForm: (players) => `
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üÉè ${p} (+ gain / - perte)</label>
                            <input type="number" id="score-${p}" value="0">
                        </div>
                    `).join('')}
                    <div class="info-box">
                        <strong>üí° Info :</strong> Entrez les gains en positif et les pertes en n√©gatif
                    </div>
                `,
                
                calculateRound: (formData, players, scores) => {
                    players.forEach(p => {
                        const amount = parseInt(formData[`score-${p}`]) || 0;
                        scores[p] += amount;
                    });
                    
                    return {
                        type: 'poker',
                        details: 'üÉè Main jou√©e'
                    };
                }
            },
            
            simple: {
                name: 'Compteur Libre',
                icon: 'üìä',
                minPlayers: 1,
                maxPlayers: 20,
                hasTeams: false,
                description: 'Score libre pour tout type de jeu',
                
                getRoundForm: (players) => `
                    <div class="success-box">
                        <strong>‚ú® Mode libre :</strong> Entrez les scores comme vous le souhaitez !
                    </div>
                    ${players.map(p => `
                        <div class="input-group">
                            <label>üìä ${p}</label>
                            <input type="number" id="score-${p}" value="0">
                        </div>
                    `).join('')}
                `,
                
                calculateRound: (formData, players, scores) => {
                    players.forEach(p => {
                        const score = parseInt(formData[`score-${p}`]) || 0;
                        scores[p] += score;
                    });
                    
                    return {
                        type: 'simple',
                        details: 'üìä Scores ajout√©s'
                    };
                }
            }
        };

        // Application principale
        const app = {
            state: {
                allPlayers: ['Joueur 1', 'Joueur 2', 'Joueur 3', 'Joueur 4'],
                selectedGame: null,
                activePlayers: [],
                teams: [],
                rounds: [],
                scores: {}
            },
            
            init() {
                this.loadData();
                this.updatePlayerList();
            },
            
            loadData() {
                const saved = sessionStorage.getItem('taverneScoresData');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.state.allPlayers = data.allPlayers || this.state.allPlayers;
                }
            },
            
            saveData() {
                sessionStorage.setItem('taverneScoresData', JSON.stringify({
                    allPlayers: this.state.allPlayers,
                    selectedGame: this.state.selectedGame,
                    activePlayers: this.state.activePlayers,
                    teams: this.state.teams,
                    rounds: this.state.rounds,
                    scores: this.state.scores
                }));
            },
            
            goHome() {
                document.getElementById('home-screen').classList.remove('hidden');
                document.getElementById('player-selection-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.add('hidden');
                this.state.selectedGame = null;
                this.state.activePlayers = [];
                this.state.teams = [];
                this.saveData();
            },
            
            selectGame(gameType) {
                this.state.selectedGame = gameType;
                const game = GAMES_CONFIG[gameType];
                
                document.getElementById('home-screen').classList.add('hidden');
                document.getElementById('player-selection-screen').classList.remove('hidden');
                
                this.showPlayerSelection(game);
            },
            
            showPlayerSelection(game) {
                const content = document.getElementById('player-selection-content');
                
                let html = `
                    <div class="info-box">
                        <strong>${game.icon} ${game.name}</strong> - ${game.description}<br>
                        üë• Nombre de joueurs : ${game.minPlayers} √† ${game.maxPlayers}
                    </div>
                `;
                
                if (game.hasTeams) {
                    html += `
                        <div class="warning-box">
                            <strong>‚ö†Ô∏è Ce jeu se joue en √©quipes de 2.</strong> S√©lectionnez exactement 4 joueurs (2 par √©quipe).
                        </div>
                        <div class="team-section">
                            <h3>üî¥ √âquipe 1</h3>
                            ${this.state.allPlayers.slice(0, Math.ceil(this.state.allPlayers.length / 2)).map((p, i) => `
                                <label class="player-checkbox">
                                    <input type="checkbox" value="${p}" data-team="0" onchange="app.handleTeamSelection()">
                                    ${p}
                                </label>
                            `).join('')}
                        </div>
                        <div class="team-section">
                            <h3>üîµ √âquipe 2</h3>
                            ${this.state.allPlayers.slice(Math.ceil(this.state.allPlayers.length / 2)).map((p, i) => `
                                <label class="player-checkbox">
                                    <input type="checkbox" value="${p}" data-team="1" onchange="app.handleTeamSelection()">
                                    ${p}
                                </label>
                            `).join('')}
                        </div>
                    `;
                } else {
                    html += `<h3 style="color: #FFD700; margin: 20px 0;">üë• S√©lectionnez les joueurs :</h3>`;
                    html += this.state.allPlayers.map(p => `
                        <label class="player-checkbox">
                            <input type="checkbox" value="${p}" onchange="app.handlePlayerSelection()">
                            ${p}
                        </label>
                    `).join('');
                }
                
                content.innerHTML = html;
            },
            
            handlePlayerSelection() {
                const checkboxes = document.querySelectorAll('#player-selection-content input[type="checkbox"]:checked');
                this.state.activePlayers = Array.from(checkboxes).map(cb => cb.value);
            },
            
            handleTeamSelection() {
                const checkboxes = document.querySelectorAll('#player-selection-content input[type="checkbox"]:checked');
                this.state.teams = [[], []];
                this.state.activePlayers = [];
                
                checkboxes.forEach(cb => {
                    const team = parseInt(cb.dataset.team);
                    this.state.teams[team].push(cb.value);
                    this.state.activePlayers.push(cb.value);
                });
            },
            
            startGameWithPlayers() {
                const game = GAMES_CONFIG[this.state.selectedGame];
                
                if (this.state.activePlayers.length < game.minPlayers || 
                    this.state.activePlayers.length > game.maxPlayers) {
                    alert(`‚ö†Ô∏è Veuillez s√©lectionner entre ${game.minPlayers} et ${game.maxPlayers} joueurs.`);
                    return;
                }
                
                if (game.hasTeams) {
                    if (this.state.teams[0].length !== 2 || this.state.teams[1].length !== 2) {
                        alert('‚ö†Ô∏è Chaque √©quipe doit avoir exactement 2 joueurs.');
                        return;
                    }
                }
                
                this.state.rounds = [];
                this.state.scores = {};
                this.state.activePlayers.forEach(p => this.state.scores[p] = 0);
                
                document.getElementById('player-selection-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');
                
                document.getElementById('game-title').textContent = `${game.icon} ${game.name}`;
                
                this.updateScoreDisplay();
                this.saveData();
            },
            
            resetGame() {
                if (confirm('üîÑ Voulez-vous vraiment r√©initialiser la partie ?')) {
                    this.state.rounds = [];
                    this.state.scores = {};
                    this.state.activePlayers.forEach(p => this.state.scores[p] = 0);
                    this.updateScoreDisplay();
                    this.saveData();
                }
            },
            
            addPlayer() {
                const input = document.getElementById('new-player-name');
                const name = input.value.trim();
                if (name && !this.state.allPlayers.includes(name)) {
                    this.state.allPlayers.push(name);
                    input.value = '';
                    this.updatePlayerList();
                    this.saveData();
                } else if (this.state.allPlayers.includes(name)) {
                    alert('‚ö†Ô∏è Ce joueur existe d√©j√† !');
                }
            },
            
            removePlayer(name) {
                if (confirm(`üóëÔ∏è Supprimer ${name} de la liste des joueurs ?`)) {
                    this.state.allPlayers = this.state.allPlayers.filter(p => p !== name);
                    this.updatePlayerList();
                    this.saveData();
                }
            },
            
            updatePlayerList() {
                const list = document.getElementById('player-list');
                if (list) {
                    list.innerHTML = this.state.allPlayers.map(p => `
                        <div class="player-item">
                            <span>üë§ ${p}</span>
                            <button class="btn btn-danger btn-small" onclick="app.removePlayer('${p.replace(/'/g, "\\'")}')">üóëÔ∏è Supprimer</button>
                        </div>
                    `).join('');
                }
            },
            
            showSettings() {
                this.updatePlayerList();
                document.getElementById('settings-modal').style.display = 'block';
            },
            
            showNewRoundModal() {
                const game = GAMES_CONFIG[this.state.selectedGame];
                const form = document.getElementById('round-form');
                
                if (game.hasTeams) {
                    form.innerHTML = game.getRoundForm(this.state.activePlayers, this.state.teams);
                } else {
                    form.innerHTML = game.getRoundForm(this.state.activePlayers);
                }
                
                document.getElementById('new-round-modal').style.display = 'block';
            },
            
            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            },
            
            submitRound() {
                const game = GAMES_CONFIG[this.state.selectedGame];
                const form = document.getElementById('round-form');
                const formData = {};
                
                form.querySelectorAll('input, select').forEach(input => {
                    const id = input.id;
                    if (id) {
                        formData[id] = input.value;
                    }
                });
                
                let roundData;
                if (game.hasTeams) {
                    roundData = game.calculateRound(formData, this.state.activePlayers, this.state.scores, this.state.teams);
                } else {
                    roundData = game.calculateRound(formData, this.state.activePlayers, this.state.scores);
                }
                
                this.state.rounds.push(roundData);
                
                this.updateScoreDisplay();
                this.closeModal('new-round-modal');
                this.saveData();
            },
            
            updateScoreDisplay() {
                const display = document.getElementById('score-display');
                const game = GAMES_CONFIG[this.state.selectedGame];
                
                let html = '<table class="score-table"><thead><tr><th>üéØ Manche</th>';
                
                if (game.hasTeams) {
                    html += `<th>üî¥ √âquipe 1<br><small>${this.state.teams[0].join(' & ')}</small></th>`;
                    html += `<th>üîµ √âquipe 2<br><small>${this.state.teams[1].join(' & ')}</small></th>`;
                } else {
                    this.state.activePlayers.forEach(p => html += `<th>üë§ ${p}</th>`);
                }
                
                html += '<th>üìã D√©tails</th></tr></thead><tbody>';
                
                // Affichage des manches
                this.state.rounds.forEach((round, idx) => {
                    html += `<tr><td><strong>Manche ${idx + 1}</strong></td>`;
                    
                    if (game.hasTeams) {
                        const team1Total = this.state.teams[0].reduce((sum, p) => sum + (this.state.scores[p] || 0), 0);
                        const team2Total = this.state.teams[1].reduce((sum, p) => sum + (this.state.scores[p] || 0), 0);
                        
                        html += `<td>${team1Total}</td>`;
                        html += `<td>${team2Total}</td>`;
                    } else {
                        this.state.activePlayers.forEach(p => {
                            html += `<td>${this.state.scores[p]}</td>`;
                        });
                    }
                    
                    html += `<td><div class="round-details">${round.details}</div></td>`;
                    html += '</tr>';
                });
                
                // Ligne des totaux
                html += '<tr class="total-row"><td>üèÜ TOTAL</td>';
                
                if (game.hasTeams) {
                    const team1Total = this.state.teams[0].reduce((sum, p) => sum + (this.state.scores[p] || 0), 0);
                    const team2Total = this.state.teams[1].reduce((sum, p) => sum + (this.state.scores[p] || 0), 0);
                    html += `<td>${team1Total}</td><td>${team2Total}</td>`;
                } else {
                    this.state.activePlayers.forEach(p => {
                        html += `<td>${this.state.scores[p] || 0}</td>`;
                    });
                }
                
                html += '<td></td></tr></tbody></table>';
                
                // Affichage du gagnant
                if (this.state.rounds.length > 0) {
                    let winner = '';
                    let bestScore = -Infinity;
                    
                    // Pour certains jeux, le score le plus bas gagne
                    const lowScoreGames = ['skyjo', 'papayoo'];
                    const isLowScoreGame = lowScoreGames.includes(this.state.selectedGame);
                    
                    if (game.hasTeams) {
                        const team1Total = this.state.teams[0].reduce((sum, p) => sum + (this.state.scores[p] || 0), 0);
                        const team2Total = this.state.teams[1].reduce((sum, p) => sum + (this.state.scores[p] || 0), 0);
                        
                        if (isLowScoreGame) {
                            winner = team1Total < team2Total ? `üî¥ √âquipe 1 (${this.state.teams[0].join(' & ')})` : `üîµ √âquipe 2 (${this.state.teams[1].join(' & ')})`;
                        } else {
                            winner = team1Total > team2Total ? `üî¥ √âquipe 1 (${this.state.teams[0].join(' & ')})` : `üîµ √âquipe 2 (${this.state.teams[1].join(' & ')})`;
                        }
                    } else {
                        this.state.activePlayers.forEach(p => {
                            const score = this.state.scores[p] || 0;
                            if (isLowScoreGame) {
                                if (bestScore === -Infinity || score < bestScore) {
                                    bestScore = score;
                                    winner = p;
                                }
                            } else {
                                if (score > bestScore) {
                                    bestScore = score;
                                    winner = p;
                                }
                            }
                        });
                    }
                    
                    html += `<div class="success-box" style="margin-top: 20px; text-align: center; font-size: 1.2em;">
                        <strong>üèÜ En t√™te : ${winner}</strong>
                    </div>`;
                }
                
                display.innerHTML = html;
            }
        };

        // Initialisation
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

        // Fermeture des modals en cliquant √† l'ext√©rieur
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>
